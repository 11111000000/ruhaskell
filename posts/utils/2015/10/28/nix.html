<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content>
        <meta name="author" content>
        <link rel="icon" href="../../../../../static/images/favicon.ico">

        <title>Nix: знакомство</title>

        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">

        <link href="../../../../../static/css/default.css" rel="stylesheet">

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

        <script>
          window.___gcfg = {
            lang: 'ru'
          };
        </script>

        <script src="https://apis.google.com/js/platform.js" async defer>
        </script>

        <link rel="alternate" type="application/rss+xml" title="RSS" href="http://ruhaskell.org/feed.xml" />

        <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
    </head>

  <body>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-58217738-1', 'auto');
      ga('send', 'pageview');

    </script>

    <div class="container">
        <nav class="navbar navbar-default navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <div id="ruhaskell-logo">
                <a class="navbar-brand" href="../../../../../" title="Домой">
                  <img alt="ruHaskell" src="../../../../../static/images/logo.png" width="60">
                </a>
              </div>
            </div>

            <div id="navbar" class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Публикации<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li>
                        <a href="../../../../../archive.html">
                            <span class="archive-link">
                                <span class="fa fa-pencil"></span>
                            </span>Статьи
                        </a>
                    </li>
                    <li>
                        <a href="../../../../../tags.html">
                            <span class="tags-link">
                                <span class="fa fa-tags"></span>
                            </span>Теги
                        </a>
                    </li>
                    <li>
                        <a href="../../../../../categories.html">
                            <span class="categories-link">
                                <span class="fa fa-star"></span>
                            </span>Категории
                        </a>
                    </li>
                    <li>
                        <a href="../../../../../authors.html">
                            <span class="authors-link">
                                <span class="fa fa-users"></span>
                            </span>Авторы
                        </a>
                    </li>
                  </ul>
                </li>

                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Общение<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li>
                        <a href="https://gitter.im/ruHaskell/forall" target="_blank">
                            <span class="chat-link">
                                <span class="fa fa-smile-o"></span>
                            </span>Чат
                        </a>
                    </li>
                    <li>
                        <a href="http://forum.ruhaskell.org" target="_blank">
                            <span class="group-link">
                                <span class="fa fa-group"></span>
                            </span>Форум
                        </a>
                    </li>
                    <li>
                        <a href="../../../../../maillist.html">
                            <span class="group-link">
                                <span class="fa fa-group"></span>
                            </span>Список рассылки
                        </a>
                    </li>
                  </ul>
                </li>

                <li><a href="../../../../../links.html">Ссылки</a></li>
              </ul>

              <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Присоединяйтесь!<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li>
                        <a href="https://twitter.com/RuHaskell" target="_blank">
                            <span id="twitter-link">
                                <span class="fa fa-twitter-square"></span>
                            </span>Twitter
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/ruHaskell/ruhaskell" target="_blank">
                            <span id="github-link">
                                <span class="fa fa-github-square"></span>
                            </span>GitHub
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/communities/117343381540538069054" target="_blank">
                            <span id="google-plus-link">
                                <span class="fa fa-google-plus-square"></span>
                            </span>Google+
                        </a>
                    </li>
                    <li>
                        <a href="../../../../../feed.xml">
                            <span id="rss-link">
                                <span class="fa fa-rss-square"></span>
                            </span>RSS
                        </a>
                    </li>
                    <li>
                        <a href="http://bananasandlenses.net/" target="_blank">
                            <span id="bananasandlenses-link">
                                <span class="fa fa-headphones"></span>
                            </span>Подкаст
                        </a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </nav>

        <div id="content">
            <h1>Nix: знакомство</h1>

<div class="row">
    <div class="col-xs-9 col-sm-8 col-md-8 col-lg-8">
        <div class="post-info">
            <strong>let</strong> author&nbsp;&nbsp;&nbsp;= "<a href="../../../../../authors/%D0%94%D0%B5%D0%BD%D0%B8%D1%81%20%D0%A8%D0%B5%D0%B2%D1%87%D0%B5%D0%BD%D0%BA%D0%BE.html">Денис Шевченко</a>"<br />
            &nbsp;&nbsp;&nbsp;&nbsp;date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= fromGregorian 2015 oct 28<br />
            &nbsp;&nbsp;&nbsp;&nbsp;category = "<a href="../../../../../categories/utils.html">Утилиты</a>"<br />
            &nbsp;&nbsp;&nbsp;&nbsp;tags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= [&quot;<a href="../../../../../tags/Nix.html">Nix</a>&quot;]
        </div>
    </div>

    <div class="col-xs-3 col-sm-4 col-md-4 col-lg-4">
        
    </div>
</div>

<p>Приветствую, друзья!</p>
<p>Итак, Nix… Признаться, я ничего не знал об этом инструменте до относительно недавнего времени. Слышать слышал, но что это и с чем едят - понятия не имел. С одной стороны, это удивляет: я знаком с Linux с 2006 года, однако с Nix никогда не сталкивался, хотя он берёт своё начало уже с 2005. С другой стороны, ничего удивительного: Nix впитал в себя идеи из Haskell, а в те годы Haskell был, мягко выражаясь, не очень популярен (напомню, в 2005 не было ещё ни Cabal, ни Hackage). Однако сегодня, когда Haskell постепенно взлетает, узнать про Nix нужно. Тем более что инструмент действительно прелюбопытный.</p>
<p>Несмотря на то, что русскоязычные статьи про Nix уже имеются (на том же Хабре), я решил, что ещё одна (или даже несколько) совсем не помешает. Конкретно эта статья будет опираться на вольный перевод <a href="http://nixer.ghost.io/why/">маленькой заметки</a>, датируемой декабрём 2013 года.</p>
<h2 id="почему-я-использую-nix">Почему я использую Nix?</h2>
<p>Возможно, вы ещё не слышали про Nix. Да и собственно, с чего вам про него слышать? Управление пакетами - задача давно решённая, у нас есть инструменты типа RPM/DEB и люди вполне счастливо живут с ними. И я тоже входил в их число, около 10 лет назад. Однако, будучи счастливым пользователем Debian, некоторые вещи мне совершенно не нравились, а именно:</p>
<ol style="list-style-type: decimal">
<li>Обновление могло сломать существующую систему.</li>
<li>Поломки во время таких обновлений стоили мне множество бессонных ночей, в течение которых я чинил то, что упало.</li>
<li>Конфигурирование системы состояло из длинного списка шагов, которые я был вынужден совершать вновь и вновь. Скрипты помогали, но не шибко.</li>
<li>Написание собственных <code>.deb</code>-пакетов было чрезвычайно утомительной задачей.</li>
</ol>
<p>А теперь позвольте рассказать вам немного о Nix и о том, как и чем он мне помог.</p>
<p>Официальный <a href="http://nixos.org/nix/">сайт</a> гласит:</p>
<blockquote>
<p>Nix is a purely functional package manager.</p>
</blockquote>
<p>Хм… Чисто-функциональный менеджер пакетов? И что же это значит? А значит это то, что пакеты воспринимаются как значения в чисто-функциональном языке</p>
<p>What does this mean? Well, it means that it treats packages like values in purely functional programming languages — they are built by functions that don’t have side-effects, and they never change after they have been built. In stead of putting everything in a global /usr, Nix stores all of its packages in a separate location on the filesystem. How this is all implemented is explained in detail on the Nix website, I can’t do that better than what is explained there. For this post I am more interested in what Nix brings to the table for me: Multiple versions: I can install multiple version of any program with the guarantee that I don’t break existing Complete dependencies: Nix makes sure that I specify all dependencies, and manage the dependencies for me, mostly automatically Multi-user support: Installing software as a non-root user was always tedious, Nix allows users to install software in a safe way Atomic upgrades and rollbacks: Nix allows me to cancel and resume an installation/upgrade at any time without the dangers of breaking existing packages/configurations To summarize the main reasons why I use Nix. Nix protects me against me I break stuff, a lot, I am sure you do too. Experimenting with newer kernel, new libraries, we all do it. But only when I started using Nix (and NixOS) I haven’t wasted any more time re-installing my system. Rollbacks are awesome! Nix let’s me do things multiple times consistently, even on different machines So much time wasted trying to figure out what are the differences between two machines. Works for me! Not for him! This happens in both builds as well as deployments. Even though we often prefer to ignore it, any dependency can actually break your system, even the low level dependencies such as kernels. Managing and tracking these dependencies will give us better reproducability, as well as traceability, allowing us to see the complete and exact changes that might have caused a system to fail. Nix exposes the things I forget When creating software you deal with software dependencies. It is easy to add a dependency on an external package or program, and forgetting about it. It often happens that such dependencies are introduced without anyone realizing, usually, because it is a piece of software that is commonly available, and thus works on most machines. Obviously, you will pay the price at some point. However, Nix forces me to specify all dependencies and my builds will fail when I fail to do so. Don’t get me wrong, this can be extremely annoying at first, but once everything is working, at least for me, it gives me comfort in knowing all my dependencies and that I don’t need to worry about them anymore. Nix, the one language to rule them all One thing I especially like about the Nix eco-system, is that I can use the same language for everything. I use it to set up my build environment for packages I am working on, defining my continuous integration builds in Hydra, managing my system configuration (NixOS), as well as my multi machine deployments in the cloud (NixOps). In my opinion, having one language has made it easy to contribute to all of the Nix ecosystem.</p>

<div id="socialButtons">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ru">Твитнуть</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

    <div class="g-plus" data-action="share" data-annotation="bubble"></div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ruhaskell'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    

        </div>

        <div id="searchForm">
            <script>
              (function() {
                var cx = '007697214108744450483:w49n7qbvpdy';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
                    '//www.google.com/cse/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
              })();
            </script>
            <gcse:search></gcse:search>
        </div>

        <footer class="footer">
            Сайт работает на <strong><a href="http://jaspervdj.be/hakyll/" target="_blank">Hakyll</a></strong> и живёт на <strong><a href="https://github.com/ruHaskell/ruhaskell" target="_blank">GitHub</a></strong>.
            <div class="stargaze">
                <a data-count-api="/repos/ruHaskell/ruhaskell#stargazers_count" data-count-href="/ruHaskell/ruhaskell/stargazers" data-icon="octicon-star" href="https://github.com/ruHaskell/ruhaskell" class="github-button">Star</a>

                <span style="padding-left: 20px;"></span>

                <a data-count-api="/repos/ruHaskell/ruhaskell#forks_count" data-count-href="/ruHaskell/ruhaskell/network" data-icon="octicon-git-branch" href="https://github.com/ruHaskell/ruhaskell" class="github-button">Fork</a>
            </div>

            <div class="copyright-note">
                Исходный код данного сайта, а также все опубликованные на нём материалы распространяются на условиях <a href="https://github.com/ruHaskell/ruhaskell/blob/master/LICENSE" target="_blank">свободной лицензии MIT</a>.
            </div>
        </footer>
    </div>

<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'ruhaskell'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = '//' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

  </body>
</html>
